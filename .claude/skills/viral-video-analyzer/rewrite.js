#!/usr/bin/env node

/**
 * 仿写脚本执行器
 */

const VideoAnalyzer = require('./index');

async function main() {
  // 原脚本内容
  const originalScript = `| 序号 | 台词 | 景别 | 分镜名称 | 画面描述 |
|------|------|------|----------|----------|
| 1 | 是我瞎了吗？怎么一撕就掉了 | 中景 | 板材质疑 | 女主角身穿黑色吊带裙，双手扶着浅色板材低头查看边缘，表情困惑；背景为装修中室内，桌上有PET-G MATT标识板材与透明塑料膜；固定镜头、轻微俯角，聚焦上半身与板材互动 |
| 2 | 全屋定制进场，一定一定要到现场验收 | 全景 | 现场开箱 | 女主角蹲在铺满纸箱与木板的地面上，正打开印有"全屋定制"字样的大纸箱，取出棕色木质板材并轻抚检查；仰拍视角展现施工环境与人物空间关系 |
| 3 | 要知道板材、材料、背板厚度这些细节 | 特写 | 手指查验 | 第一人称视角手部特写，食指精准指向柜体底部接缝处，轻微晃动模拟真实查验过程；深棕色木纹柜体与拼花木地板清晰可见，背景有充电器等生活细节 |
| 4 | 发现问题立马要求整改 | 中景 | 现场指导 | 女主角站立于客厅区域，右手向上指向天花板方向，左手按在未完工深棕色柜体上，正与身后男性工人沟通；平视稳定镜头，桌面散落螺丝刀、图纸等工具 |
| 5 | 不知道咋验收的，就跟着我挨个对 | 中景 | 板材对比 | 女主角背对镜头，双手持浅色板材与墙上竖立的大板材比对颜色与尺寸；侧面稳定拍摄，背景可见通风口与消防报警器，板材背面贴有PET-G MATT防尘膜 |
| 6 | 第一看板材的颜色，特别是白色柜门 | 特写 | 缺陷曝光 | 手持手机拍摄视角，聚焦白色柜体顶部破损边缘——金属锈迹明显、表面磨损脱层；近景微抖强化真实感，瓷砖墙面与内部孔洞构成问题背景 |
| 7 | 要是不想出现这种五颜六色的白，提前让商家寄一块小样 | 中景 | 尺寸测量 | 女主角背对镜头，专注使用黄色卷尺测量竖立深色板材厚度；发髻用黑色发夹固定，环境为房间一角，含门框与灯光，镜头从后方稳定跟拍 |
| 8 | 安装的时候就能现场核对了 | 特写 | 数据确认 | 极特写镜头聚焦卷尺紧贴板材边缘，"18mm"数值被虚线圈出强调；深棕色木纹板材背景虚化，无人员出镜，突出合同约定厚度的验证动作 |
| 9 | 第二…… | 特写 | 封边测试 | 手指（指甲整洁、戴戒指）用力按压板材同色系木纹封边条，测试其粘合牢固度；特写聚焦接触点，封边条边缘光滑，背景为模糊柜体结构 |
| 10 | 有的黑心商家偷梁换柱 | 近景 | 细节质问 | 女主角侧脸入镜，眉头微蹙，目光直视镜头外某处问题点，右手食指指向画面外；背景为白色柜体局部，隐约可见锈迹与瑕疵，手持轻微晃动增强临场感 |`;

  // 仿写要求
  const userInstruction = `请将这个"全屋定制验收"的主题改成"厨房水电验收"主题。
具体要求：
1. 开头改成水电验收中的常见问题（比如电线裸露、水管漏水等）
2. 保持原有的10个镜头结构
3. 场景从客厅改成厨房
4. 检查重点从板材改成水电材料（电线规格、水管品牌、插座位置等）
5. 保持原有的节奏感和情绪曲线：开头震惊 → 强调重要性 → 教验方法 → 揭露黑幕
6. 台词风格要符合装修避坑的调性，口语化、接地气`;

  const analyzer = new VideoAnalyzer();

  try {
    const result = await analyzer.rewrite(originalScript, userInstruction, {
      originalTitle: '全屋定制验收指南',
      metadata: {
        theme: '装修验收',
        niche: '全屋定制'
      }
    });

    console.log('\n✅ 仿写完成！');
    console.log(`📄 Markdown: ${result.mdPath}`);
    console.log(`🌐 HTML: ${result.htmlPath}\n`);

  } catch (error) {
    console.error('❌ 仿写失败:', error.message);
    process.exit(1);
  }
}

main();
