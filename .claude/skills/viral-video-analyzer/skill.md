# 爆款视频拆解仿写 Skill

**版本：** 1.0.0
**作者：** AI Assistant
**最后更新：** 2025-02-04

---

## 概述

这是一个开箱即用的视频分析拆解和仿写工具，帮助团队快速：

1. **拆解爆款视频** - 从小红书、抖音等平台下载视频，自动提取分镜脚本
2. **智能仿写** - 基于拆解结果，快速创作新的爆款视频脚本
3. **零代码定制** - 通过编辑 Prompt 模板自定义拆解和仿写规则

### 核心特性

- ✅ 多平台支持（抖音、小红书、B站等）
- ✅ 智能关键帧采样（节省 API 成本）
- ✅ 阿里云 Qwen 多模态分析（视觉 + 语音）
- ✅ Prompt 模板系统（零代码可配置）
- ✅ 交互式引导（适合新手）
- ✅ 缓存管理（避免重复下载）

---

## 环境要求

### 必需工具

```bash
# Node.js (建议 v16+)
node --version

# yt-dlp (视频下载)
pip install yt-dlp

# ffmpeg (视频处理)
# macOS
brew install ffmpeg

# Ubuntu/Debian
sudo apt install ffmpeg

# Windows
# 从 https://ffmpeg.org/download.html 下载
```

### 环境变量

```bash
# 设置阿里云 API 密钥
export QWEN_API_KEY=sk-your-api-key-here
```

获取 API 密钥：https://dashscope.aliyuncs.com/

---

## 快速开始

### 方式 1：对话式交互

直接在 Claude Code 中说：

```
帮我分析这个视频：https://www.xiaohongshu.com/explore/...
```

Skill 会引导你完成：
1. 选择视觉分析方案（直接视频 / 关键帧采样）
2. 选择拆解模板（默认 / 详细 / 快速）
3. 自动执行下载、分析、拆解
4. 预览结果，选择是否仿写

### 方式 2：命令式调用

```
分析视频 [链接] 使用默认模板
拆解视频 [链接] 使用详细模板
仿写这个视频脚本：改成美食教程风格
```

---

## 工作流程

```
┌─────────────────────────────────────────────────────────────┐
│  1. 用户输入视频链接                                          │
└────────────────────┬────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│  2. 选择分析模式（交互式）                                     │
│     [1] 直接视频分析（< 3分钟）                               │
│     [2] 智能关键帧采样（1-5分钟）★推荐                        │
│     [3] 自定义采样间隔                                        │
└────────────────────┬────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│  3. 选择拆解模板                                              │
│     [1] default - 标准拆解（5个字段）                         │
│     [2] detailed - 详细拆解（增加情绪、时长、运镜）           │
│     [3] fast - 快速拆解（只保留关键镜头）                     │
└────────────────────┬────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│  4. 自动执行                                                  │
│     ✓ 下载视频 (yt-dlp)                                      │
│     ✓ 提取音频                                               │
│     ✓ 采样关键帧 (ffmpeg)                                    │
│     ✓ 视觉分析 (Qwen VL)                                     │
│     ✓ 语音转录 (Qwen ASR)                                    │
│     ✓ 脚本拆解 (Qwen LLM)                                    │
└────────────────────┬────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│  5. 输出结果                                                  │
│     • Markdown 脚本文件                                       │
│     • 表格预览（终端显示）                                    │
│     • 保存到 output/scripts/                                 │
└────────────────────┬────────────────────────────────────────┘
                     │
                     ▼
┌─────────────────────────────────────────────────────────────┐
│  6. 仿写（可选）                                              │
│     输入仿写要求 → 选择仿写模板 → 生成新脚本                   │
└─────────────────────────────────────────────────────────────┘
```

---

## 输出格式

### 拆解结果表格

```markdown
| 序号 | 台词 | 景别 | 分镜名称 | 画面描述 |
|------|------|------|----------|----------|
| 1 | 姐妹们看过来，今天分享一款超好用的底妆 | 中景 | 开场介绍 | 主播面对镜头，手持底妆产品，面带微笑向观众打招呼 |
| 2 | [无台词] | 特写 | 产品展示 | 手部特写镜头，手指轻抹底妆液，展示产品质地 |
| 3 | 这款底妆遮瑕力超强，而且非常轻薄 | 近景 | 效果讲解 | 主播近距离展示上妆效果，配合手势强调产品优势 |
```

### 仿写结果（与原版结构一致）

```markdown
原版 → 仿写对比：

| 序号 | 原版台词 | 仿写台词 | 原版画面 | 仿写画面 |
|------|---------|---------|---------|---------|
| 1 | 姐妹们... | 宝子们... | 手持底妆... | 手持食材... |
```

---

## 自定义配置

### 1. 修改字段定义

编辑 `.claude/skills/viral-video-analyzer/config/fields.json`：

```json
{
  "table_columns": [
    {"key": "序号", "type": "number", "required": true},
    {"key": "台词", "type": "text", "required": true},
    {"key": "景别", "type": "enum", "options": ["特写", "近景", "中景", "全景", "远景"]},
    {"key": "分镜名称", "type": "text", "max_length": 10},
    {"key": "画面描述", "type": "text", "min_length": 30, "max_length": 150}
  ]
}
```

**增加字段示例：**
```json
{
  "key": "情绪",
  "type": "enum",
  "options": ["兴奋", "平静", "紧张", "温暖", "幽默"],
  "required": false
}
```

### 2. 创建自定义模板

```bash
# 复制默认模板
cp .claude/skills/viral-video-analyzer/templates/breakdown/default.md \
   .claude/skills/viral-video-analyzer/templates/breakdown/my-version.md

# 编辑模板
vim .claude/skills/viral-video-analyzer/templates/breakdown/my-version.md
```

模板中使用变量：
- `{visual_context}` - 视觉分析结果
- `{asr_result}` - 语音转录结果
- `{video_metadata}` - 视频元数据
- `{fields_definition}` - 字段定义
- `{user_instruction}` - 用户指令

### 3. 切换默认模板

编辑 `.claude/skills/viral-video-analyzer/config/settings.json`：

```json
{
  "templates": {
    "default_breakdown": "detailed",
    "default_rewrite": "change-scene"
  }
}
```

---

## 仿写模式

### 1. 默认仿写 (default)

根据用户要求自由创作，保持原视频结构。

**示例：**
```
把这个美妆教程改成美食教程，保持快节奏
```

### 2. 换场景仿写 (change-scene)

严格保持结构、节奏、表达方式，只替换主题内容。

**适用场景：**
- 跨品类复用（美妆 → 美食 → 时尚）
- 同品类不同产品（口红A → 口红B）

### 3. 换口吻仿写 (change-tone)

保持内容和场景不变，调整表达语气。

**可选风格：**
- 闺蜜唠嗑（亲切、热情）
- 专业讲师（严肃、权威）
- 幽默搞笑（轻松、调侃）
- 情感共鸣（温暖、走心）
- 极简高冷（简洁、直接）

### 4. 创意混剪 (remix)

自由重组镜头，改变叙事结构。

**操作：**
- 倒叙（从结果开始）
- 删减冗余镜头
- 重复强化重点
- 跨脚本混剪

---

## 命令参考

### 分析视频

```
# 对话式
帮我分析这个视频：[链接]

# 指定模板
使用详细模板分析这个视频：[链接]

# 指定分析模式
使用关键帧采样分析：[链接]

# 命令式
/video-analyzer analyze [链接] --template detailed --method keyframe
```

### 仿写脚本

```
# 对话式
仿写这个脚本：改成美食教程风格

# 指定模式
使用换场景模式仿写：把美妆改成美食

# 继续调整
把第3-5个镜头的节奏加快
把画面描述写得更详细一点
```

### 配置管理

```
# 查看当前配置
查看当前分析配置

# 修改配置
设置默认模板为 detailed
设置分析模式为 keyframe

# 重置配置
重置为默认配置
```

### 缓存管理

```
# 清理特定视频缓存
清理 [链接] 的缓存

# 清理所有缓存
清理所有缓存

# 强制重新分析
强制重新分析这个视频：[链接]
```

---

## 文件结构

```
.claude/skills/viral-video-analyzer/
├── skill.md                    # 本文件
├── templates/                  # Prompt 模板
│   ├── breakdown/              # 拆解器模板
│   │   ├── default.md          # 标准拆解
│   │   ├── detailed.md         # 详细拆解
│   │   └── fast.md             # 快速拆解
│   └── rewrite/                # 仿写器模板
│       ├── default.md          # 默认仿写
│       ├── change-scene.md     # 换场景
│       ├── change-tone.md      # 换口吻
│       └── remix.md            # 创意混剪
├── config/                     # 配置文件
│   ├── fields.json             # 字段定义
│   └── settings.json           # 系统配置
├── utils/                      # 工具函数
│   ├── qwen-client.js          # 阿里云 API
│   ├── video-processor.js      # 视频处理
│   └── template-engine.js      # 模板引擎
├── cache/                      # 缓存目录
│   ├── videos/                 # 视频文件
│   ├── audio/                  # 音频文件
│   ├── keyframes/              # 关键帧
│   └── analysis/               # 分析结果
└── output/                     # 输出目录
    ├── scripts/                # 生成的脚本
    └── pdf/                    # 导出的 PDF
```

---

## 常见问题

### Q: 视频下载失败？

**A:** 检查以下几点：
1. 确认链接可以正常访问
2. 更新 yt-dlp：`pip install -U yt-dlp`
3. 某些平台可能需要登录或付费内容

### Q: API 调用失败？

**A:**
1. 检查环境变量：`echo $QWEN_API_KEY`
2. 验证密钥有效性：https://dashscope.aliyuncs.com/
3. 检查账户余额

### Q: 关键帧采样太慢？

**A:**
1. 增大采样间隔（默认自动计算，目标20帧）
2. 使用直接视频分析模式（适合短视频）
3. 使用缓存避免重复分析

### Q: 拆解结果不准确？

**A:**
1. 尝试不同的拆解模板（detailed 更详细）
2. 尝试直接视频分析模式（保留完整时序）
3. 修改 Prompt 模板，优化提示词

### Q: 如何支持新平台？

**A:** 编辑 `config/settings.json`：
```json
{
  "video": {
    "supported_platforms": ["douyin.com", "xiaohongshu.com", "bilibili.com", "新平台.com"]
  }
}
```

---

## 技术架构

### 核心组件

1. **QwenClient** - 阿里云 API 封装
   - 视觉理解：qwen-vl-max
   - 语音识别：qwen-audio-turbo
   - 通用 LLM：qwen-plus

2. **VideoProcessor** - 视频处理
   - yt-dlp：视频下载
   - ffmpeg：关键帧提取
   - 智能缓存：避免重复处理

3. **TemplateEngine** - 模板系统
   - 模板加载和渲染
   - 字段定义注入
   - 自定义模板支持

### 数据流

```
URL → yt-dlp → 视频文件
                ↓
            ffmpeg → 关键帧 + 音频
                ↓
            Qwen API → 视觉分析 + 语音转录
                ↓
            Template → Prompt 渲染
                ↓
            Qwen LLM → 结构化脚本
                ↓
            Markdown → 输出文件
```

---

## 更新日志

### v1.0.0 (2025-02-04)
- ✅ 初始版本发布
- ✅ 支持多平台视频下载
- ✅ 集成阿里云 Qwen 多模态
- ✅ Prompt 模板系统
- ✅ 智能缓存管理
- ✅ 交互式引导
- ✅ 四种仿写模式

---

## 许可证

MIT License

---

## 联系方式

如有问题或建议，请联系团队或提交 Issue。
